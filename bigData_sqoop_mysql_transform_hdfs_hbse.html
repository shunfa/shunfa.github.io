<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>利用Sqoop將MySQL資料庫表單轉移至HDFS、HBase過程 (以Piwik資料庫為例) &mdash; shunfaDOC 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="shunfaDOC 1.0 documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">shunfaDOC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">利用Sqoop將MySQL資料庫表單轉移至HDFS、HBase過程 (以Piwik資料庫為例)</a><ul>
<li><a class="reference internal" href="#id1">前置作業</a></li>
<li><a class="reference internal" href="#id2">本文所使用的各套件版本</a></li>
<li><a class="reference internal" href="#id4">目錄結構及管理頁面</a><ul>
<li><a class="reference internal" href="#id5">本機目錄</a></li>
<li><a class="reference internal" href="#hdfs">HDFS</a></li>
<li><a class="reference internal" href="#id6">管理頁面</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqoop">安裝Sqoop</a><ul>
<li><a class="reference internal" href="#id7">設定</a><ul>
<li><a class="reference internal" href="#sqoop-env-sh">sqoop-env.sh</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#jps">啟動所有服務，jps確認服務狀態</a></li>
<li><a class="reference internal" href="#piwikmysql">將Piwik資料匯入MySQL</a></li>
<li><a class="reference internal" href="#id8">使用Sqoop</a><ul>
<li><a class="reference internal" href="#id9">將資料匯入HDFS</a></li>
<li><a class="reference internal" href="#hbase">將資料匯入HBase</a></li>
<li><a class="reference internal" href="#id10">Sqoop 其他</a></li>
<li><a class="reference internal" href="#hortonwork-link">Hortonwork版本參考( link )</a></li>
<li><a class="reference internal" href="#mysql">關於MySQL</a><ul>
<li><a class="reference internal" href="#id11">MYSQL資料表最大能達到多少</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id12">驗證區</a></li>
<li><a class="reference internal" href="#id13">小結</a></li>
<li><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/bigData_sqoop_mysql_transform_hdfs_hbse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sqoopmysqlhdfshbase-piwik">
<h1>利用Sqoop將MySQL資料庫表單轉移至HDFS、HBase過程 (以Piwik資料庫為例)<a class="headerlink" href="#sqoopmysqlhdfshbase-piwik" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>前置作業<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>安裝Hadoop，並啟動。(可透過 <a class="reference external" href="./_packages/hadoop/QuickDeployHadoop-2013-12-19.tar.gz">QuickDeployHadoop</a> 建立)</li>
<li>安裝zookeeper，並啟動。</li>
<li>安裝Hbase，並啟動。</li>
<li>安裝MySQL。(JDBC也要裝，資料庫管理可搭配phpmyadmin服用)</li>
<li>安裝Sqoop。</li>
<li>安裝Hive。</li>
</ol>
<p><em>QuickDeployHadoop: 下載、解壓、執行install即可，已經包含自行編譯過的64bit版本之Hadoop</em></p>
</div>
<div class="section" id="id2">
<h2>本文所使用的各套件版本<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Hadoop: 2.2.0</li>
<li>Zookeeper: 3.4.5</li>
<li>Hbase: 0.96.1.1-hadoop2</li>
<li>Sqoop: 1.4.4</li>
<li>Hive: 0.12.0</li>
<li>MySQL: 5.5.34</li>
<li><a class="reference external" href="./_packages/hadoop/hadoop_apps_2014-01-22.tar.gz">懶人包下載</a> (含zookeeper, hbase, sqoop，解壓至 <tt class="docutils literal"><span class="pre">/home/hadoop/</span></tt> 後還需要作細部設定修正)</li>
</ul>
<p><em>懶人包來自虛擬機器</em></p>
</div>
<div class="section" id="id4">
<h2>目錄結構及管理頁面<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>本機目錄<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Hadoop安裝目錄：/opt/hadoop-2.2.0-quick/</li>
<li>其他相關套件安裝路徑：/home/hadoop/apps</li>
</ul>
</div>
<div class="section" id="hdfs">
<h3>HDFS<a class="headerlink" href="#hdfs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Hbase: /hbase</li>
<li>Hive: /user/hive</li>
</ul>
</div>
<div class="section" id="id6">
<h3>管理頁面<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Hadoop: <a class="reference external" href="http://nosql-test-a:50070/">http://nosql-test-a:50070/</a></li>
<li>Hbase: <a class="reference external" href="http://nosql-test-a:60010/">http://nosql-test-a:60010/</a></li>
</ul>
</div>
</div>
<div class="section" id="sqoop">
<h2>安裝Sqoop<a class="headerlink" href="#sqoop" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>下載解壓縮至/home/hadoop/apps/</li>
<li>開始設定</li>
</ol>
<div class="section" id="id7">
<h3>設定<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="section" id="sqoop-env-sh">
<h4>sqoop-env.sh<a class="headerlink" href="#sqoop-env-sh" title="Permalink to this headline">¶</a></h4>
<p><strong>$ cp $SQOOP_HOME/conf/sqoop-env-template.sh $SQOOP_HOME/conf/sqoop-env.sh</strong></p>
<ul class="simple">
<li>修改成以下內容：</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>export HADOOP_COMMON_HOME=/opt/hadoop-2.2.0-quick
export HADOOP_MAPRED_HOME=/opt/hadoop-2.2.0-quick/share/hadoop/mapreduce
export HBASE_HOME=/home/hadoop/apps/hbase-0.96.1.1-hadoop2
export HIVE_HOME=/home/hadoop/apps/hive-0.12.0
export ZOOCFGDIR=/home/hadoop/apps/zookeeper-3.4.5/conf
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="jps">
<h2>啟動所有服務，jps確認服務狀態<a class="headerlink" href="#jps" title="Permalink to this headline">¶</a></h2>
<div class="highlight-.."><div class="highlight"><pre>hadoop@nosql-test-a:/opt$ jps
2719 ResourceManager
20837 Jps
2221 DataNode
3849 HMaster
2981 NodeManager
3580 JobHistoryServer
4122 HRegionServer
1932 NameNode
2544 SecondaryNameNode
3671 QuorumPeerMain
</pre></div>
</div>
</div>
<div class="section" id="piwikmysql">
<h2>將Piwik資料匯入MySQL<a class="headerlink" href="#piwikmysql" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>因為 <tt class="docutils literal"><span class="pre">phpmyadmin</span></tt> 不支援大檔匯入，而從piwik匯出的資料庫檔案又很大，測試時需要在測試的機器上進行測試，且不是每個人都像我一樣需要透過友善介面匯入資料庫，此時，mysql 的 <tt class="docutils literal"><span class="pre">source</span></tt> 就變得很重要了！</li>
<li>source 用法</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>use testDB;
source /home/shunfa/testtable.sql
</pre></div>
</div>
<ul class="simple">
<li>修改MySQL設定檔</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><cite>vim /etc/mysql/my.cnf</cite> 的 <cite>bind-address</cite></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="id8">
<h2>使用Sqoop<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<ol class="loweralpha simple">
<li>將資料匯入HDFS</li>
<li>將資料匯入HBase</li>
</ol>
<div class="section" id="id9">
<h3>將資料匯入HDFS<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>將資料庫表單內容匯入至HDFS上，其中 <tt class="docutils literal"><span class="pre">piwik</span></tt> 為資料庫名稱， <tt class="docutils literal"><span class="pre">piwik_log_visit</span></tt> 為表單名稱。</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">-p</span></tt> 指令可以透過終端機輸入密碼或透過 <tt class="docutils literal"><span class="pre">--password-file</span> <span class="pre">my-sqoop-password</span></tt> 執行</li>
</ul>
</div></blockquote>
<div class="highlight-.."><div class="highlight"><pre>$ bin/sqoop import --connect jdbc:mysql://nosql-test-a/piwik --username root --password your_pw --table piwik_log_visit
</pre></div>
</div>
<ul class="simple">
<li>確認是否匯入成功</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>hadoop@nosql-test-a:~/apps/sqoop-1.4.4$ hadoop fs -ls
Found 4 items
drwxr-xr-x   - hadoop supergroup          0 2014-01-22 11:15 piwik_log_link_visit_action
drwxr-xr-x   - hadoop supergroup          0 2014-01-22 08:11 piwik_log_visit
drwxr-xr-x   - hadoop supergroup          0 2014-01-22 11:13 piwik_log_visit_1
drwxr-xr-x   - hadoop supergroup          0 2014-01-22 09:52 piwik_option
</pre></div>
</div>
</div>
<div class="section" id="hbase">
<h3>將資料匯入HBase<a class="headerlink" href="#hbase" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>將資料庫表單內容匯入至HBase上，其中 <tt class="docutils literal"><span class="pre">piwik</span></tt> 為資料庫名稱， <tt class="docutils literal"><span class="pre">piwik_log_visit</span></tt> 為表單名稱， <tt class="docutils literal"><span class="pre">hbase_test_table</span></tt> 為hbase上的表單名稱， <tt class="docutils literal"><span class="pre">test_table_col1</span></tt> 為HBase上的column-family名稱， <tt class="docutils literal"><span class="pre">idvisit</span></tt> 為 <tt class="docutils literal"><span class="pre">piwik_log_visit</span></tt> 表單中的key值。</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>bin/sqoop import \
--connect jdbc:mysql://nosql-test-a/piwik \
--table ``piwik_log_visit`` \
--username root --password ``your_pw`` \
--hbase-table hbase_test_table \
--column-family ``test_table_col1`` \
--hbase-row-key idvisit --hbase-create-table
</pre></div>
</div>
<p><em>註：不支援斷行、MySQL位址不支援Hostname</em></p>
<ul class="simple">
<li>確認是否匯入成功</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>$ bin/hbase shell
hbase(main):001:0&gt; list
hbase_test_table
test
2 row(s) in 2.2200 seconds

=&gt; [&quot;hbase_test_table&quot;, &quot;test&quot;]
</pre></div>
</div>
<ul class="simple">
<li>刪除Hbase表單</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>disable &#39;test&#39;
drop &#39;test&#39;
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>Sqoop 其他<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>append mode：指的是，當你的資料庫內容只有新增一些row，而其他原本存在的row沒有被修改過，則可使用此模式新增新的row。</li>
<li>Sharing the Metastore Between Sqoop Clients：其他機器也可以使用相同的Sqoop環境</li>
</ul>
</div>
<div class="section" id="hortonwork-link">
<h3>Hortonwork版本參考( <a class="reference external" href="./_images/hortonworks_asparagus20a.png">link</a> )<a class="headerlink" href="#hortonwork-link" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="mysql">
<h3>關於MySQL<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4>MYSQL資料表最大能達到多少<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>ref: <a class="reference external" href="http://mysqlwp.com/?page_id=29">http://mysqlwp.com/?page_id=29</a></p>
</div>
</div>
</div>
<div class="section" id="id12">
<h2>驗證區<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>驗證MySQL的資料筆數與HBase是否一樣，分別如下：</p>
<table border="1" class="docutils">
<caption>MySQL V.S. HBase資料筆數</caption>
<colgroup>
<col width="50%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Table Name</th>
<th class="head">MySQL</th>
<th class="head">HBase</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>piwik_log_action</td>
<td>64,189</td>
<td>64,189</td>
</tr>
<tr class="row-odd"><td>piwik_log_link_visit_action</td>
<td>66,761</td>
<td>66,761</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id13">
<h2>小結<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Hadoop Ecosystem很大，除了安裝Hadoop外，還需要其他套件配合才有辦法發揮其效果，日後佈署上或許可以花些時間寫自動化安裝、佈署、管理工具或透過佈署虛擬機器的方式建置，以減少系統配置時間。</li>
<li>Sqoop有支援Script方式匯入資料庫相關Data，可提昇資料轉移效率。</li>
</ol>
</div>
<div class="section" id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>為什麼 <tt class="docutils literal"><span class="pre">Hbase</span></tt> 下指令時，會有 <tt class="docutils literal"><span class="pre">SLF4J:</span> <span class="pre">Class</span> <span class="pre">path</span> <span class="pre">contains</span> <span class="pre">multiple</span> <span class="pre">SLF4J</span> <span class="pre">bindings.</span></tt></li>
</ul>
<blockquote>
<div><ul class="simple">
<li>解：把 <tt class="docutils literal"><span class="pre">${Hbase}/lib/slf4j-log4j12-*.jar</span></tt> 移掉即可。</li>
<li>原因：Hadoop也有相同檔案，執行時JVM會發現有重複的jar檔被呼叫使用。</li>
</ul>
</div></blockquote>
<p><em>last update: 2014-02-07</em></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">shunfaDOC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, shunfa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>