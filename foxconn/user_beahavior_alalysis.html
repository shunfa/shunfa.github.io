<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>使用者行為分析 - 後台資料轉移 &mdash; shunfaDOC 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="shunfaDOC 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">shunfaDOC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">使用者行為分析 - 後台資料轉移</a><ul>
<li><a class="reference internal" href="#mysql-piwik">MySQL - Piwik</a><ul>
<li><a class="reference internal" href="#tables">Tables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">進度</a><ul>
<li><a class="reference internal" href="#id3">任務一</a><ul>
<li><a class="reference internal" href="#mysql">1. [公有雲]  取得公有雲MySQL環境</a></li>
<li><a class="reference internal" href="#hadoop-zookeeper-hbase-sqoop">2. [私有雲]  建立Hadoop, Zookeeper, Hbase, Sqoop環境</a></li>
<li><a class="reference internal" href="#sqoop-script">3. [私有雲]  利用Sqoop Script 將公有雲上的資料傳回私有雲上</a><ul>
<li><a class="reference internal" href="#hbase-piwik-goal">HBase架構，以表單 <tt class="docutils literal"><span class="pre">piwik_goal</span></tt> 為例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqoop">4. [私有雲]  利用Sqoop 作差異化更新</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/foxconn/user_beahavior_alalysis.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>使用者行為分析 - 後台資料轉移<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>需求：
公有雲(阿里雲)的儲存空間需要計費，加上其架構為RDBMS，若沒有定時整理維護，RDBMS架構無法處理資料過大的問題，所以在公有雲上的資料每隔一段時間(3個月)必須轉到私有雲(雲起 or Dick&#8217;s OpenStack)自行維護，並在特定的時間內倒回統計後的資料回到公有雲。</p>
<ul class="simple">
<li>任務一：公私有雲間的資料轉移 =&gt; 資料流向：公有雲 -&gt; 私有雲</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>透過Sqoop =&gt; RDBMD(MySQL)&#64;公有雲 -&gt; NoSQL(Hbase)&#64;私有雲</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>環境初始化 - 環境建立階段<ol class="arabic">
<li>[公有雲]  取得公有雲MySQL環境</li>
<li>[私有雲]  建立Hadoop, Zookeeper, Hbase, Sqoop環境</li>
</ol>
</li>
<li>資料搬移階段<ol class="arabic" start="3">
<li>[私有雲]  利用Sqoop Script 將公有雲上的資料傳回私有雲上</li>
</ol>
</li>
<li>資料維護階段<ol class="arabic" start="4">
<li>[私有雲]  利用Sqoop 作差異化更新(尚未Survey, Ch3 新增, Ch5.4 更新)</li>
<li>[私有雲]  資料壓縮與封存</li>
</ol>
</li>
<li>資料萃取及顯示階段<ol class="arabic" start="6">
<li>[私有雲]  透過統計或計算分析工具提煉資料</li>
<li>[私有雲]  與前端整合進行資料呈現(可考慮Solr檢索、其他圖形化工具顯示)</li>
</ol>
</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul>
<li><p class="first">任務二：公私有雲間的資料轉移 =&gt; 資料流向：私有雲 -&gt; 公有雲</p>
<blockquote>
<div><ol class="arabic simple" start="8">
<li>[私有雲]  定義回傳內容，將資料導回公有雲</li>
<li>[公有雲]  與前端整合進行資料呈現</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">無法定義在任何階段的測試</p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>不同語系測試</li>
<li>資料型態：語系, Date, timestamp</li>
<li>HBase 倒回 MySQL的值是否可以正常</li>
<li>增量轉移的資料量上限</li>
<li>Log機制</li>
</ul>
</div></blockquote>
<div class="section" id="mysql-piwik">
<h2>MySQL - Piwik<a class="headerlink" href="#mysql-piwik" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tables">
<h3>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">piwik_access</div>
<div class="line">piwik_archive_blob_2013_12</div>
<div class="line">piwik_archive_blob_2014_01</div>
<div class="line">piwik_archive_numeric_2013_12</div>
<div class="line">piwik_archive_numeric_2014_01</div>
<div class="line">piwik_goal</div>
<div class="line">piwik_log_action</div>
<div class="line">piwik_log_conversion</div>
<div class="line">piwik_log_conversion_item</div>
<div class="line">piwik_log_link_visit_action</div>
<div class="line">piwik_log_profiling</div>
<div class="line">piwik_log_visit</div>
<div class="line">piwik_logger_message</div>
<div class="line">piwik_option</div>
<div class="line">piwik_report</div>
<div class="line">piwik_segment</div>
<div class="line">piwik_session</div>
<div class="line">piwik_site</div>
<div class="line">piwik_site_url</div>
<div class="line">piwik_user</div>
<div class="line">piwik_user_dashboard</div>
<div class="line">piwik_user_language</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>進度<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>任務一<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="mysql">
<h4>1. [公有雲]  取得公有雲MySQL環境<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>目前已在vm上建立模擬公有雲的MySQL環境，並把Piwik資料庫匯入。</li>
</ul>
</div>
<div class="section" id="hadoop-zookeeper-hbase-sqoop">
<h4>2. [私有雲]  建立Hadoop, Zookeeper, Hbase, Sqoop環境<a class="headerlink" href="#hadoop-zookeeper-hbase-sqoop" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>目前已經建立完成，正常使用中</li>
<li><a class="reference external" href="../bigData_sqoop_mysql_transform_hdfs_hbse.html">安裝過程紀錄文件</a></li>
</ul>
</div>
<div class="section" id="sqoop-script">
<h4>3. [私有雲]  利用Sqoop Script 將公有雲上的資料傳回私有雲上<a class="headerlink" href="#sqoop-script" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>針對MySQL表單建立對應的Hbase表單欄位</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>根據MySQL表單名稱建立HBase表單名稱，RowKey為根據MySQL PRIMARY欄位進行設計，若為多重Key值，則以 <tt class="docutils literal"><span class="pre">,</span></tt> 分開</li>
</ul>
</div></blockquote>
<div class="highlight-.."><div class="highlight"><pre>$ sqoop import \
  --connect jdbc:mysql://192.168.57.101/piwik \
  --table piwik_access --username root \
  --password shunfa@foxconn \
  --hbase-table piwik_access \
  --column-family piwik_access_col \
  --hbase-row-key login,idsite --hbase-create-table
</pre></div>
</div>
<div class="highlight-.."><div class="highlight"><pre>$ sqoop import \
  --connect jdbc:mysql://192.168.57.101/piwik \
  --table piwik_archive_blob_2013_12 \
  --username root --password shunfa@foxconn \
  --hbase-table piwik_archive_blob_2013_12 \
  --column-family piwik_archive_blob_2013_12_col \
  --hbase-row-key idarchive,name --hbase-create-table

14/01/24 14:47:22 INFO mapreduce.ImportJobBase: Transferred 0 bytes in 43.5708 seconds (0 bytes/sec)
14/01/24 14:47:22 INFO mapreduce.ImportJobBase: Retrieved 16542 records.
</pre></div>
</div>
<div class="highlight-.."><div class="highlight"><pre>$ sqoop import \
  --connect jdbc:mysql://192.168.57.101/piwik \
  --table piwik_archive_blob_2014_01 \
  --username root --password shunfa@foxconn \
  --hbase-table piwik_archive_blob_2014_01 \
  --column-family piwik_archive_blob_2014_01_col \
  --hbase-row-key idarchive,name --hbase-create-table

14/01/24 14:58:56 INFO mapreduce.ImportJobBase: Transferred 0 bytes in 39.3163 seconds (0 bytes/sec)
14/01/24 14:58:56 INFO mapreduce.ImportJobBase: Retrieved 13213 records.
</pre></div>
</div>
<p><em>其他略</em></p>
<ul class="simple">
<li>執行結果</li>
</ul>
<div class="highlight-.."><div class="highlight"><pre>hbase(main):001:0&gt; list
TABLE
piwik_access
piwik_archive_blob_2013_12
piwik_archive_blob_2014_01
piwik_archive_numeric_2013_12
piwik_archive_numeric_2014_01
piwik_goal
piwik_log_action
piwik_log_conversion
piwik_log_conversion_item
piwik_log_link_visit_action
piwik_log_visit
piwik_logger_message
piwik_option
piwik_report
piwik_segment
piwik_session
piwik_site
piwik_user
piwik_user_dashboard
piwik_user_language
20 row(s) in 2.5750 seconds

=&gt; [&quot;piwik_access&quot;, &quot;piwik_archive_blob_2013_12&quot;, &quot;piwik_archive_blob_2014_01&quot;, &quot;piwik_archive_numeric_2013_12&quot;, &quot;piwik_archive_numeric_2014_01&quot;, &quot;piwik_goal&quot;,   &quot;piwik_log_action&quot;, &quot;piwik_log_conversion&quot;, &quot;piwik_log_conversion_item&quot;, &quot;piwik_log_link_visit_action&quot;, &quot;piwik_log_visit&quot;, &quot;piwik_logger_message&quot;, &quot;piwik_option&quot;, &quot;piwik_report&quot;, &quot;piwik_segment&quot;, &quot;piwik_session&quot;, &quot;piwik_site&quot;, &quot;piwik_user&quot;, &quot;piwik_user_dashboard&quot;, &quot;piwik_user_language&quot;]
</pre></div>
</div>
<p><em>註：HBase每隔一段時間才會將資料寫入HDFS</em></p>
<div class="section" id="hbase-piwik-goal">
<h5>HBase架構，以表單 <tt class="docutils literal"><span class="pre">piwik_goal</span></tt> 為例<a class="headerlink" href="#hbase-piwik-goal" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Value -&gt; Table, Rowkey, Family, Column, Timestamp</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>piwik_goal, idsite_idgoal, piwik_goal_col, {name, match_attribute, pattern, pattern_type, case_sensitive, allow_multiple, revenue, deleted}, timestamp</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Column Oriented Storage (<a class="reference external" href="./_images/row-and-column-layouts.jpg">link</a>)</li>
</ul>
</div>
</div>
<div class="section" id="sqoop">
<h4>4. [私有雲]  利用Sqoop 作差異化更新<a class="headerlink" href="#sqoop" title="Permalink to this headline">¶</a></h4>
<p><em>Last Update: 2014-01-24</em></p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">shunfaDOC 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, shunfa.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>